# 복잡한 백오피스에서 폼의 상태 다루기

## 컨텍스트로 폼 관리하기

### 그 이유?

1. 프롭 드릴링의 방지
2. 하나의 스토어로 상태 관리
3. 다른 라이브러리를 사용하지 않는 순수 리액트

## Context로 하나의 form 스토어를 생성하면 발생하는 문제

- 최상단에서 리듀서 폼 상태, 디스패치를 훅으로 생성하고 Context Provider로 추가
- 하위 컴포넌트에서 useContext 훅 사용

- 문제는 개수가 많아질때나 폼의 렌더가 느릴때
- 관리되고 있는 값을 하나라도 변경하면 컨텍스트 사용 요소가 다 업데이트 됨 (모든 값 감시)

- 이를 최적화를 하기위해 메모이제이션하는 방식을 사용하지만 컨텍스트를 사용하는 경우에서는 불가능
- context를 프롭으로 넘기면 가능하지만 nesting 된 항목이면 그 한계가 명백, 사용성, 퍼포먼스 감소

## 효율적으로 사용하는 방법

1. 상태 독립화, 디바운스로 업데이트 지연

- 상태와 실제 폼이 다를 수 있기 때문에 제출 전에 확인해야함

2. 불필요한 상태의 경우 비제어로 전환

- 렌더를 확실히 줄일 수 있지만 이 형태로 구현하는 것이 불가능한 경우도 많음

3. 폼과 디스패치 컨텍스트를 나눠서 구현
   - 리렌더 자체를 원천적으로 막을 수는 없음 (폼의 업데이트와 디스패치를 분리해서 렌더 횟수를 줄일 뿐)

- 결국 메모이제이션, 프롭을 적절히 섞어줘야 최선

## 여전히 더 나은 해결책이 필요하다면?

### useImperativeHandle

- 리액트의 기본 작동 방식인 단방향 데이터 흐름을 우회하는 법
- 사용하면 코드를 이해하기 어렵고 디버깅이 복잡해지기 때문에 딱 필요할때만 써야함
- 부모 컴포넌트에서 넘긴 ref를 자식에서 커스텀할 수 있음
- 실제 부모에서 생성된 ref에 자식의 상태, 상태 설정(setState)도 추가 가능
- 그 과정에 오류나 검증도 추가 가능
- 이로써 더 많은 사용 케이스 만족가능

### 소스 코드

https://github.com/seonghyeonkimm/react-form
